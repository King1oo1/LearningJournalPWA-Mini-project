<!DOCTYPE html>
<html lang="en">
<head>
  <!-- PWA Manifest -->
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">

  <!-- Theme Color for Mobile -->
  <meta name="theme-color" content="#3498db">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="LearnJournal">

  <!-- Single Icon for all platforms -->
  <link rel="icon" href="{{ url_for('static', filename='images/icon.png') }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/icon.png') }}">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Projects - Chandandeep Singh</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <!-- Navigation will be inserted here by JavaScript -->

  <main class="container">
    <h1>My Projects</h1>

    <div class="projects-grid">
      <article class="project-card">
        <h2>Learning Journal PWA</h2>
        <p>A Progressive Web App that documents my learning journey through the Mobile Application Development course. This project demonstrates responsive design, mobile-first approach, clean code structure using HTML, CSS, and JavaScript, with interactive features like theme switching and dynamic content.</p>
        <div class="tech-stack">
          <span class="tech-tag">HTML5</span>
          <span class="tech-tag">CSS</span>
          <span class="tech-tag">JavaScript</span>
          <span class="tech-tag">PWA</span>
          <span class="tech-tag">Responsive Design</span>
          <span class="tech-tag">DOM Manipulation</span>
          <span class="tech-tag">Flexbox</span>
          <span class="tech-tag">CSS Grid</span>
        </div>
      </article>
    </div>

    <div class="coming-soon">
      <h3>More Projects Coming Soon!</h3>
      <p>I'm continuously working on new projects and will update this section as I complete them. Currently learning advanced JavaScript and mobile development frameworks.</p>
    </div>
  </main>

  <footer class="footer">
    <p>&copy; 2025 Chandandeep Singh. All rights reserved.</p>
  </footer>

  <!-- ALL THE JS FILES - IN CORRECT ORDER -->
  <script src="{{ url_for('static', filename='js/storage.js') }}"></script>
  <script src="{{ url_for('static', filename='js/browser.js') }}"></script>
  <script src="{{ url_for('static', filename='js/thirdparty.js') }}"></script>
  <script src="{{ url_for('static', filename='js/script.js') }}"></script>

  <script>
    // Register Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('{{ url_for("static", filename="js/sw.js") }}')
          .then(function(registration) {
            console.log('‚úÖ ServiceWorker registration successful with scope: ', registration.scope);
          })
          .catch(function(error) {
            console.log('‚ùå ServiceWorker registration failed: ', error);
          });
      });
    }

    // Online/Offline Detection (Extra Feature)
    function updateOnlineStatus() {
      const statusElement = document.getElementById('network-status');
      if (statusElement) {
        if (navigator.onLine) {
          statusElement.innerHTML = 'üü¢ Online';
          statusElement.style.background = 'linear-gradient(135deg, #27ae60 0%, #229954 100%)';
        } else {
          statusElement.innerHTML = 'üî¥ Offline - Using cached data';
          statusElement.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
        }
      }
    }

    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);

    // Initialize on load
    document.addEventListener('DOMContentLoaded', updateOnlineStatus);

    // PWA Installation Prompt
    let deferredPrompt;

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      showInstallPromotion();
    });

    function showInstallPromotion() {
      const installBtn = document.createElement('button');
      installBtn.innerHTML = 'üì± Install App';
      installBtn.className = 'btn-primary';
      installBtn.style.margin = '0.5rem';
      installBtn.onclick = installPWA;

      const hero = document.querySelector('.hero');
      if (hero) {
        hero.appendChild(installBtn);
      }
    }

    async function installPWA() {
      if (!deferredPrompt) return;

      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;

      if (outcome === 'accepted') {
        console.log('‚úÖ User accepted the install prompt');
        showSuccessMessage('App installed successfully! üéâ');
      } else {
        console.log('‚ùå User dismissed the install prompt');
      }

      deferredPrompt = null;
    }
  </script>
</body>
</html>